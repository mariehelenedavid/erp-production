<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Production</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root">
        <div style="padding: 20px; text-align: center;">
            <p>Chargement de l'ERP...</p>
        </div>
    </div>
    
    <script>
        // Application ERP simplifi√©e et robuste
        let activeModule = 'dashboard';
        let showModal = false;
        let modalType = '';
        let selectedItem = null;
        let showItemDetail = false;

        // Donn√©es initiales
        let productions = [
            {
                id: 1,
                produit: 'Chaise Bureau Premium',
                quantite: 50,
                statut: 'En cours',
                dateDebut: '2025-08-25',
                dateFin: '2025-09-05',
                coutMatiere: 1250,
                coutMainOeuvre: 800,
                progression: 65
            }

        // Variables globales pour la gestion des onglets et de l'√©dition
        let currentTab = 'general';
        let editModeActive = false;

        // Gestion des onglets dans la modal d√©tail
        function setActiveTab(tab) {
            currentTab = tab;
            renderApp();
        }

        // Fonctions de gestion g√©n√©rale des items
        function saveGeneralChanges() {
            const form = document.getElementById('editGeneralForm');
            const formData = new FormData(form);
            
            const updatedItem = {
                ...selectedItem,
                nom: formData.get('nom'),
                categorie: formData.get('categorie'),
                quantite: parseFloat(formData.get('quantite')) || 0,
                unite: formData.get('unite'),
                prixUnitaire: parseFloat(formData.get('prixUnitaire')) || 0,
                description: formData.get('description')
            };
            
            updatedItem.valeur = updatedItem.quantite * updatedItem.prixUnitaire;
            
            // Mettre √† jour l'inventaire
            const index = inventaire.findIndex(item => item.id === selectedItem.id);
            if (index !== -1) {
                inventaire[index] = updatedItem;
                selectedItem = updatedItem;
            }
            
            renderApp();
        }

        function resetGeneralForm() {
            renderApp();
        }

        function addAttribute() {
            const input = document.getElementById('newAttribute');
            const newAttr = input.value.trim();
            
            if (newAttr && !selectedItem.attributs.includes(newAttr)) {
                selectedItem.attributs.push(newAttr);
                input.value = '';
                
                // Mettre √† jour l'inventaire
                const index = inventaire.findIndex(item => item.id === selectedItem.id);
                if (index !== -1) {
                    inventaire[index] = selectedItem;
                }
                
                renderApp();
            }
        }

        function removeAttribute(attr) {
            selectedItem.attributs = selectedItem.attributs.filter(a => a !== attr);
            
            // Mettre √† jour l'inventaire
            const index = inventaire.findIndex(item => item.id === selectedItem.id);
            if (index !== -1) {
                inventaire[index] = selectedItem;
            }
            
            renderApp();
        }

        function duplicateItem(itemId) {
            const itemToDuplicate = inventaire.find(item => item.id === itemId);
            if (itemToDuplicate) {
                const newId = Math.max(...inventaire.map(i => i.id), 0) + 1;
                const duplicatedItem = {
                    ...itemToDuplicate,
                    id: newId,
                    nom: itemToDuplicate.nom + ' (Copie)',
                    quantite: 0,
                    valeur: 0
                };
                
                inventaire.push(duplicatedItem);
                renderApp();
            }
        }

        // Fonctions de gestion des nomenclatures
        function addNomenclature() {
            const newId = Math.max(...(selectedItem.nomenclatures?.map(n => n.id) || [0]), 0) + 1;
            const newNomenclature = {
                id: newId,
                nom: `Nomenclature ${newId}`,
                type: 'Production',
                active: selectedItem.nomenclatures?.length === 0, // Active si c'est la premi√®re
                composants: [],
                coutTotal: 0,
                tempsProduction: 0
            };
            
            if (!selectedItem.nomenclatures) {
                selectedItem.nomenclatures = [];
            }
            
            selectedItem.nomenclatures.push(newNomenclature);
            
            // Mettre √† jour l'inventaire
            const index = inventaire.findIndex(item => item.id === selectedItem.id);
            if (index !== -1) {
                inventaire[index] = selectedItem;
            }
            
            renderApp();
        }

        function toggleNomenclature(nomenclatureId) {
            const nomenclature = selectedItem.nomenclatures.find(n => n.id === nomenclatureId);
            if (nomenclature) {
                // Si on active cette nomenclature, d√©sactiver les autres
                if (!nomenclature.active) {
                    selectedItem.nomenclatures.forEach(n => n.active = false);
                    nomenclature.active = true;
                } else {
                    nomenclature.active = false;
                }
                
                // Mettre √† jour l'inventaire
                const index = inventaire.findIndex(item => item.id === selectedItem.id);
                if (index !== -1) {
                    inventaire[index] = selectedItem;
                }
                
                renderApp();
            }
        }

        function deleteNomenclature(nomenclatureId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette nomenclature ?')) {
                selectedItem.nomenclatures = selectedItem.nomenclatures.filter(n => n.id !== nomenclatureId);
                
                // Mettre √† jour l'inventaire
                const index = inventaire.findIndex(item => item.id === selectedItem.id);
                if (index !== -1) {
                    inventaire[index] = selectedItem;
                }
                
                renderApp();
            }
        }

        function addComposant(nomenclatureId) {
            const composantName = prompt('Nom du composant:');
            const quantite = parseFloat(prompt('Quantit√©:') || '0');
            const unite = prompt('Unit√©:') || 'pcs';
            const cout = parseFloat(prompt('Co√ªt:') || '0');
            
            if (composantName && quantite > 0) {
                const nomenclature = selectedItem.nomenclatures.find(n => n.id === nomenclatureId);
                if (nomenclature) {
                    nomenclature.composants.push({
                        composant: composantName,
                        quantite: quantite,
                        unite: unite,
                        cout: cout
                    });
                    
                    // Recalculer le co√ªt total
                    nomenclature.coutTotal = nomenclature.composants.reduce((sum, c) => sum + (c.cout || 0), 0);
                    
                    // Mettre √† jour l'inventaire
                    const index = inventaire.findIndex(item => item.id === selectedItem.id);
                    if (index !== -1) {
                        inventaire[index] = selectedItem;
                    }
                    
                    renderApp();
                }
            }
        }

        function removeComposant(nomenclatureId, composantIndex) {
            if (confirm('Supprimer ce composant ?')) {
                const nomenclature = selectedItem.nomenclatures.find(n => n.id === nomenclatureId);
                if (nomenclature) {
                    nomenclature.composants.splice(composantIndex, 1);
                    
                    // Recalculer le co√ªt total
                    nomenclature.coutTotal = nomenclature.composants.reduce((sum, c) => sum + (c.cout || 0), 0);
                    
                    // Mettre √† jour l'inventaire
                    const index = inventaire.findIndex(item => item.id === selectedItem.id);
                    if (index !== -1) {
                        inventaire[index] = selectedItem;
                    }
                    
                    renderApp();
                }
            }
        }

        // Fonctions de gestion des variantes
        function addVariante() {
            const nom = prompt('Nom de la variante:');
            if (nom) {
                const newId = Math.max(...(selectedItem.variantes?.map(v => v.id) || [0]), 0) + 1;
                const newVariante = {
                    id: newId,
                    nom: nom,
                    attributs: {},
                    stock: 0,
                    prix: selectedItem.prixUnitaire
                };
                
                // Ajouter des attributs par d√©faut bas√©s sur les attributs de l'item
                selectedItem.attributs?.forEach(attr => {
                    const valeur = prompt(`Valeur pour ${attr}:`);
                    if (valeur) {
                        newVariante.attributs[attr] = valeur;
                    }
                });
                
                if (!selectedItem.variantes) {
                    selectedItem.variantes = [];
                }
                
                selectedItem.variantes.push(newVariante);
                
                // Mettre √† jour l'inventaire
                const index = inventaire.findIndex(item => item.id === selectedItem.id);
                if (index !== -1) {
                    inventaire[index] = selectedItem;
                }
                
                renderApp();
            }
        }

        function deleteVariante(varianteId) {
            if (confirm('Supprimer cette variante ?')) {
                selectedItem.variantes = selectedItem.variantes.filter(v => v.id !== varianteId);
                
                // Mettre √† jour l'inventaire
                const index = inventaire.findIndex(item => item.id === selectedItem.id);
                if (index !== -1) {
                    inventaire[index] = selectedItem;
                }
                
                renderApp();
            }
        }

        function adjustStock(varianteId, action) {
            if (typeof varianteId === 'string') {
                // Ajustement du stock principal
                const quantite = parseFloat(document.getElementById('adjustmentQuantity')?.value || '0');
                const type = document.getElementById('adjustmentType')?.value || 'manual';
                const motif = document.getElementById('adjustmentReason')?.value || '';
                
                if (quantite > 0) {
                    if (action === 'add') {
                        selectedItem.quantite += quantite;
                    } else if (action === 'remove') {
                        selectedItem.quantite = Math.max(0, selectedItem.quantite - quantite);
                    }
                    
                    selectedItem.valeur = selectedItem.quantite * selectedItem.prixUnitaire;
                    
                    // Mettre √† jour l'inventaire
                    const index = inventaire.findIndex(item => item.id === selectedItem.id);
                    if (index !== -1) {
                        inventaire[index] = selectedItem;
                    }
                    
                    // Reset des champs
                    if (document.getElementById('adjustmentQuantity')) {
                        document.getElementById('adjustmentQuantity').value = '';
                    }
                    if (document.getElementById('adjustmentReason')) {
                        document.getElementById('adjustmentReason').value = '';
                    }
                    
                    renderApp();
                }
            } else {
                // Ajustement du stock d'une variante
                const variante = selectedItem.variantes.find(v => v.id === varianteId);
                if (variante) {
                    const quantite = parseFloat(prompt('Quantit√© √† ' + (action === 'add' ? 'ajouter' : 'retirer') + ':') || '0');
                    if (quantite > 0) {
                        if (action === 'add') {
                            variante.stock += quantite;
                        } else if (action === 'remove') {
                            variante.stock = Math.max(0, variante.stock - quantite);
                        }
                        
                        // Mettre √† jour l'inventaire
                        const index = inventaire.findIndex(item => item.id === selectedItem.id);
                        if (index !== -1) {
                            inventaire[index] = selectedItem;
                        }
                        
                        renderApp();
                    }
                }
            }
        }

        // Fonctions de gestion des fournisseurs
        function addFournisseur() {
            const nom = prompt('Nom du fournisseur:');
            const prix = parseFloat(prompt('Prix unitaire:') || '0');
            const delai = prompt('D√©lai de livraison:') || '1-2 jours';
            
            if (nom && prix > 0) {
                if (!selectedItem.fournisseurs) {
                    selectedItem.fournisseurs = [];
                }
                
                selectedItem.fournisseurs.push({
                    nom: nom,
                    prix: prix,
                    delai: delai
                });
                
                // Mettre √† jour l'inventaire
                const index = inventaire.findIndex(item => item.id === selectedItem.id);
                if (index !== -1) {
                    inventaire[index] = selectedItem;
                }
                
                renderApp();
            }
        }

        function deleteFournisseur(fournisseurIndex) {
            if (confirm('Supprimer ce fournisseur ?')) {
                selectedItem.fournisseurs.splice(fournisseurIndex, 1);
                
                // Si on a supprim√© le fournisseur principal, le premier devient principal
                if (fournisseurIndex === 0 && selectedItem.fournisseurs.length > 0) {
                    selectedItem.fournisseurPrincipal = selectedItem.fournisseurs[0].nom;
                }
                
                // Mettre √† jour l'inventaire
                const index = inventaire.findIndex(item => item.id === selectedItem.id);
                if (index !== -1) {
                    inventaire[index] = selectedItem;
                }
                
                renderApp();
            }
        }

        function setMainSupplier(fournisseurIndex) {
            // R√©organiser pour mettre le fournisseur s√©lectionn√© en premier
            const fournisseur = selectedItem.fournisseurs[fournisseurIndex];
            selectedItem.fournisseurs.splice(fournisseurIndex, 1);
            selectedItem.fournisseurs.unshift(fournisseur);
            selectedItem.fournisseurPrincipal = fournisseur.nom;
            
            // Mettre √† jour l'inventaire
            const index = inventaire.findIndex(item => item.id === selectedItem.id);
            if (index !== -1) {
                inventaire[index] = selectedItem;
            }
            
            renderApp();
        }

        function createPurchaseOrder(fournisseurIndex) {
            const fournisseur = selectedItem.fournisseurs[fournisseurIndex];
            const quantite = prompt(`Quantit√© √† commander chez ${fournisseur.nom}:`);
            
            if (quantite && parseFloat(quantite) > 0) {
                const total = parseFloat(quantite) * fournisseur.prix;
                alert(`Commande cr√©√©e:\\n\\nFournisseur: ${fournisseur.nom}\\nProduit: ${selectedItem.nom}\\nQuantit√©: ${quantite} ${selectedItem.unite}\\nTotal: ${total.toFixed(2)}$\\nD√©lai: ${fournisseur.delai}`);
                
                // En production, ici on cr√©erait une vraie commande d'achat
            }
        }

        function viewSupplierHistory(fournisseurIndex) {
            const fournisseur = selectedItem.fournisseurs[fournisseurIndex];
            alert(`Historique avec ${fournisseur.nom}:\\n\\n(Fonctionnalit√© en d√©veloppement)\\n\\n- Commandes pass√©es\\n- Performance d√©lais\\n- √âvolution des prix\\n- Notes qualit√©`);
        }

        // Mise √† jour de la fonction pour g√©rer les onglets
        function renderItemDetail() {
            if (!selectedItem) return '';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[95vh] overflow-y-auto">
                        <div class="flex flex-col h-full">
                            <!-- Header -->
                            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                                <div>
                                    <h3 class="text-2xl font-semibold text-gray-800">${selectedItem.nom}</h3>
                                    <p class="text-gray-600">${selectedItem.categorie} ‚Ä¢ ${selectedItem.quantite} ${selectedItem.unite} disponible</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="duplicateItem(${selectedItem.id})" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2">
                                        <span>üìã</span><span>Dupliquer</span>
                                    </button>
                                    <button onclick="closeItemDetail()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                        Fermer
                                    </button>
                                </div>
                            </div>

                            <!-- Onglets -->
                            <div class="border-b border-gray-200">
                                <div class="flex space-x-0">
                                    <button onclick="setActiveTab('general')" class="px-6 py-3 border-b-2 font-medium text-sm ${currentTab === 'general' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üìã G√©n√©ral
                                    </button>
                                    <button onclick="setActiveTab('nomenclatures')" class="px-6 py-3 border-b-2 font-medium text-sm ${currentTab === 'nomenclatures' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üîß Nomenclatures
                                    </button>
                                    <button onclick="setActiveTab('variantes')" class="px-6 py-3 border-b-2 font-medium text-sm ${currentTab === 'variantes' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üé® Variantes
                                    </button>
                                    <button onclick="setActiveTab('fournisseurs')" class="px-6 py-3 border-b-2 font-medium text-sm ${currentTab === 'fournisseurs' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üè™ Fournisseurs
                                    </button>
                                    <button onclick="setActiveTab('stocks')" class="px-6 py-3 border-b-2 font-medium text-sm ${currentTab === 'stocks' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üìä Stocks & Co√ªts
                                    </button>
                                </div>
                            </div>

                            <!-- Contenu des onglets -->
                            <div class="flex-1 p-6">
                                ${renderTabContent(currentTab)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTabContent(activeTab) {
            switch(activeTab) {
                case 'general':
                    return renderGeneralTab();
                case 'nomenclatures':
                    return renderNomenclaturesTab();
                case 'variantes':
                    return renderVariantesTab();
                case 'fournisseurs':
                    return renderFournisseursTab();
                case 'stocks':
                    return renderStocksTab();
                default:
                    return renderGeneralTab();
            }
        },
            {
                id: 2,
                produit: 'Table Conf√©rence XL',
                quantite: 10,
                statut: 'Planifi√©',
                dateDebut: '2025-09-10',
                dateFin: '2025-09-20',
                coutMatiere: 2800,
                coutMainOeuvre: 1200,
                progression: 0
            },
            {
                id: 3,
                produit: 'Armoire Classement',
                quantite: 25,
                statut: 'Termin√©',
                dateDebut: '2025-08-10',
                dateFin: '2025-08-30',
                coutMatiere: 1875,
                coutMainOeuvre: 750,
                progression: 100
            }
        ];

        let inventaire = [
            {
                id: 1,
                nom: 'Bois Ch√™ne Premium',
                categorie: 'Mati√®re Premi√®re',
                quantite: 120,
                unite: 'm¬≤',
                typeUnite: 'surface',
                prixUnitaire: 45,
                valeur: 5400,
                seuilMin: 20,
                fournisseurPrincipal: 'Bois du Qu√©bec Inc.',
                fournisseurs: [
                    { nom: 'Bois du Qu√©bec Inc.', prix: 45, delai: '5-7 jours' },
                    { nom: 'Foresterie Premium', prix: 48, delai: '3-5 jours' }
                ],
                nomenclatures: [],
                variantes: [],
                attributs: ['Essence', 'Grade'],
                description: 'Bois de ch√™ne premium pour meubles haut de gamme'
            },
            {
                id: 2,
                nom: 'Quincaillerie Haut Gamme',
                categorie: 'Composants',
                quantite: 500,
                unite: 'pcs',
                typeUnite: 'unit√©',
                prixUnitaire: 8.5,
                valeur: 4250,
                seuilMin: 100,
                fournisseurPrincipal: 'M√©taux Sp√©cialis√©s',
                fournisseurs: [
                    { nom: 'M√©taux Sp√©cialis√©s', prix: 8.5, delai: '2-3 jours' },
                    { nom: 'Quincaillerie Pro', prix: 9.0, delai: '1-2 jours' }
                ],
                nomenclatures: [],
                variantes: [
                    { id: 1, nom: 'Vis Inox 4x50mm', attributs: { type: 'Vis', materiau: 'Inox', taille: '4x50mm' }, stock: 200, prix: 8.5 },
                    { id: 2, nom: 'Vis Laiton 4x50mm', attributs: { type: 'Vis', materiau: 'Laiton', taille: '4x50mm' }, stock: 150, prix: 9.2 },
                    { id: 3, nom: 'Vis Inox 5x60mm', attributs: { type: 'Vis', materiau: 'Inox', taille: '5x60mm' }, stock: 150, prix: 9.8 }
                ],
                attributs: ['Type', 'Mat√©riau', 'Taille'],
                description: 'Visserie et quincaillerie de qualit√© professionnelle'
            },
            {
                id: 3,
                nom: 'Vernis Protection',
                categorie: 'Finition',
                quantite: 15,
                unite: 'L',
                typeUnite: 'volume',
                prixUnitaire: 35,
                valeur: 525,
                seuilMin: 5,
                fournisseurPrincipal: 'Chimie Pro',
                fournisseurs: [
                    { nom: 'Chimie Pro', prix: 35, delai: '1-2 jours' },
                    { nom: 'Finitions Expert', prix: 33, delai: '3-4 jours' }
                ],
                nomenclatures: [],
                variantes: [
                    { id: 1, nom: 'Vernis Mat', attributs: { finition: 'Mat', couleur: 'Transparent' }, stock: 8, prix: 35 },
                    { id: 2, nom: 'Vernis Brillant', attributs: { finition: 'Brillant', couleur: 'Transparent' }, stock: 7, prix: 37 }
                ],
                attributs: ['Finition', 'Couleur'],
                description: 'Vernis de protection haute qualit√© pour finitions durables'
            },
            {
                id: 4,
                nom: 'Chaise Bureau Premium',
                categorie: 'Produit Fini',
                quantite: 75,
                unite: 'pcs',
                typeUnite: 'unit√©',
                prixUnitaire: 250,
                valeur: 18750,
                seuilMin: 10,
                fournisseurPrincipal: 'Production Interne',
                fournisseurs: [
                    { nom: 'Production Interne', prix: 250, delai: 'imm√©diat' }
                ],
                nomenclatures: [
                    {
                        id: 1,
                        nom: 'Nomenclature Standard',
                        type: 'Production',
                        active: true,
                        composants: [
                            { composant: 'Bois Ch√™ne Premium', quantite: 2.5, unite: 'm¬≤', cout: 112.5 },
                            { composant: 'Quincaillerie Haut Gamme', quantite: 15, unite: 'pcs', cout: 127.5 },
                            { composant: 'Vernis Protection', quantite: 0.5, unite: 'L', cout: 17.5 }
                        ],
                        coutTotal: 257.5,
                        tempsProduction: 4.5
                    },
                    {
                        id: 2,
                        nom: 'Nomenclature √âconomique',
                        type: 'Production',
                        active: false,
                        composants: [
                            { composant: 'Bois Ch√™ne Premium', quantite: 2.0, unite: 'm¬≤', cout: 90 },
                            { composant: 'Quincaillerie Haut Gamme', quantite: 12, unite: 'pcs', cout: 102 },
                            { composant: 'Vernis Protection', quantite: 0.3, unite: 'L', cout: 10.5 }
                        ],
                        coutTotal: 202.5,
                        tempsProduction: 3.8
                    }
                ],
                variantes: [
                    { id: 1, nom: 'Chaise Ch√™ne Mat', attributs: { couleur: 'Ch√™ne Naturel', finition: 'Mat' }, stock: 35, prix: 250 },
                    { id: 2, nom: 'Chaise Ch√™ne Brillant', attributs: { couleur: 'Ch√™ne Naturel', finition: 'Brillant' }, stock: 25, prix: 270 },
                    { id: 3, nom: 'Chaise Ch√™ne Teint√©', attributs: { couleur: 'Ch√™ne Teint√©', finition: 'Mat' }, stock: 15, prix: 280 }
                ],
                attributs: ['Couleur', 'Finition'],
                description: 'Chaise de bureau ergonomique en ch√™ne premium'
            }
        ];

        let mainOeuvre = [
            {
                id: 1,
                employe: 'Jean Tremblay',
                poste: '√âb√©niste Senior',
                tauxHoraire: 35,
                heuresTravaillees: 160,
                coutTotal: 5600,
                mois: 'Ao√ªt 2025'
            },
            {
                id: 2,
                employe: 'Marie Dubois',
                poste: 'Finition Sp√©cialiste',
                tauxHoraire: 30,
                heuresTravaillees: 155,
                coutTotal: 4650,
                mois: 'Ao√ªt 2025'
            },
            {
                id: 3,
                employe: 'Pierre Lavoie',
                poste: 'Assembleur',
                tauxHoraire: 25,
                heuresTravaillees: 165,
                coutTotal: 4125,
                mois: 'Ao√ªt 2025'
            }
        ];

        // Fonctions utilitaires
        function calculateKPIs() {
            const totalProductions = productions.length;
            const productionsEnCours = productions.filter(p => p.statut === 'En cours').length;
            const valeurInventaireTotal = inventaire.reduce((sum, item) => sum + item.valeur, 0);
            const coutMainOeuvreTotal = mainOeuvre.reduce((sum, mo) => sum + mo.coutTotal, 0);
            const coutMatiereTotal = productions.reduce((sum, p) => sum + p.coutMatiere, 0);
            const alertesStock = inventaire.filter(item => item.quantite <= item.seuilMin).length;

            return {
                totalProductions,
                productionsEnCours,
                valeurInventaireTotal,
                coutMainOeuvreTotal,
                coutMatiereTotal,
                alertesStock
            };
        }

        function renderApp() {
            const kpis = calculateKPIs();
            
            const app = `
                <div class="flex min-h-screen bg-gray-100">
                    <!-- Navigation -->
                    <div class="bg-blue-900 text-white w-64 min-h-screen p-4">
                        <h1 class="text-2xl font-bold mb-8 text-center">ERP Production</h1>
                        <nav class="space-y-2">
                            <button onclick="setActiveModule('dashboard')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'dashboard' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>üìä</span><span>Tableau de Bord</span>
                            </button>
                            <button onclick="setActiveModule('production')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'production' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>üîß</span><span>Production</span>
                            </button>
                            <button onclick="setActiveModule('inventaire')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'inventaire' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>üì¶</span><span>Inventaire</span>
                            </button>
                            <button onclick="setActiveModule('couts')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'couts' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>üí∞</span><span>Co√ªts</span>
                            </button>
                            <button onclick="setActiveModule('rapports')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'rapports' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>üìã</span><span>Rapports</span>
                            </button>
                        </nav>
                    </div>

                    <!-- Contenu principal -->
                    <div class="flex-1 p-6">
                        ${renderActiveModule(kpis)}
                    </div>
                </div>

                ${showModal ? renderModal() : ''}
                ${showItemDetail ? renderItemDetail() : ''}
            `;

            document.getElementById('root').innerHTML = app;
        }

        function renderActiveModule(kpis) {
            switch(activeModule) {
                case 'dashboard': return renderDashboard(kpis);
                case 'production': return renderProduction();
                case 'inventaire': return renderInventaire(kpis);
                case 'couts': return renderCouts(kpis);
                case 'rapports': return renderRapports();
                default: return renderDashboard(kpis);
            }
        }

        function renderDashboard(kpis) {
            return `
                <div class="space-y-6">
                    <h2 class="text-3xl font-bold text-gray-800">Tableau de Bord</h2>
                    
                    <!-- KPIs -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm">Productions Totales</p>
                                    <p class="text-2xl font-bold text-gray-800">${kpis.totalProductions}</p>
                                </div>
                                <span class="text-blue-500 text-2xl">üîß</span>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm">En Cours</p>
                                    <p class="text-2xl font-bold text-gray-800">${kpis.productionsEnCours}</p>
                                </div>
                                <span class="text-green-500 text-2xl">‚è∞</span>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm">Valeur Inventaire</p>
                                    <p class="text-2xl font-bold text-gray-800">${kpis.valeurInventaireTotal.toLocaleString()}$</p>
                                </div>
                                <span class="text-purple-500 text-2xl">üì¶</span>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm">Alertes Stock</p>
                                    <p class="text-2xl font-bold text-gray-800">${kpis.alertesStock}</p>
                                </div>
                                <span class="text-red-500 text-2xl">‚ö†Ô∏è</span>
                            </div>
                        </div>
                    </div>

                    <!-- Productions r√©centes -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Productions R√©centes</h3>
                            <div class="space-y-3">
                                ${productions.slice(0, 3).map(prod => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">${prod.produit}</p>
                                            <p class="text-sm text-gray-600">Quantit√©: ${prod.quantite}</p>
                                        </div>
                                        <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(prod.statut)}">
                                            ${prod.statut}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Co√ªts du Mois</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Mati√®res Premi√®res</span>
                                    <span class="font-semibold text-gray-800">${kpis.coutMatiereTotal.toLocaleString()}$</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Main d'≈íuvre</span>
                                    <span class="font-semibold text-gray-800">${kpis.coutMainOeuvreTotal.toLocaleString()}$</span>
                                </div>
                                <div class="border-t pt-2 flex justify-between items-center font-bold">
                                    <span class="text-gray-800">Total</span>
                                    <span class="text-gray-800">${(kpis.coutMatiereTotal + kpis.coutMainOeuvreTotal).toLocaleString()}$</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderInventaire(kpis) {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-800">Gestion d'Inventaire</h2>
                        <button onclick="openModal('inventaire')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2">
                            <span>‚ûï</span><span>Ajouter Article</span>
                        </button>
                    </div>

                    ${kpis.alertesStock > 0 ? `
                        <div class="bg-red-50 border-l-4 border-red-400 p-4">
                            <div class="flex">
                                <span class="text-red-400 mr-3">‚ö†Ô∏è</span>
                                <p class="text-sm text-red-700">
                                    <strong>Alerte Stock:</strong> ${kpis.alertesStock} article(s) sous le seuil minimum
                                </p>
                            </div>
                        </div>
                    ` : ''}

                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Article</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cat√©gorie</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix Unit.</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valeur</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${inventaire.map(item => `
                                        <tr class="hover:bg-gray-50 cursor-pointer" onclick="openItemDetail(${item.id})">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${item.nom}</div>
                                                <div class="text-sm text-gray-500">${item.fournisseurPrincipal}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.categorie}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.quantite} ${item.unite}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.prixUnitaire}$</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.valeur.toLocaleString()}$</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${item.quantite <= item.seuilMin ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                                    ${item.quantite <= item.seuilMin ? 'Stock Bas' : 'OK'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2" onclick="event.stopPropagation()">
                                                <button onclick="openItemDetail(${item.id})" class="text-blue-600 hover:text-blue-900" title="Voir d√©tails">üëÅÔ∏è</button>
                                                <button onclick="editItem(${item.id})" class="text-green-600 hover:text-green-900" title="Modifier">‚úèÔ∏è</button>
                                                <button onclick="deleteItem(${item.id})" class="text-red-600 hover:text-red-900" title="Supprimer">üóëÔ∏è</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProduction() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-800">Gestion de Production</h2>
                        <button onclick="openModal('production')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2">
                            <span>‚ûï</span><span>Nouvel Ordre</span>
                        </button>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produit</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantit√©</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progression</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Co√ªt Total</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${productions.map(prod => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${prod.produit}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${prod.quantite}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(prod.statut)}">
                                                    ${prod.statut}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${prod.progression}%"></div>
                                                </div>
                                                <span class="text-xs text-gray-500">${prod.progression}%</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                ${(prod.coutMatiere + prod.coutMainOeuvre).toLocaleString()}$
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCouts(kpis) {
            return `
                <div class="space-y-6">
                    <h2 class="text-3xl font-bold text-gray-800">Gestion des Co√ªts</h2>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Mati√®res Premi√®res</h3>
                            <p class="text-2xl font-bold text-blue-600">${kpis.coutMatiereTotal.toLocaleString()}$</p>
                            <p class="text-sm text-gray-500">Ce mois</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Main d'≈íuvre</h3>
                            <p class="text-2xl font-bold text-green-600">${kpis.coutMainOeuvreTotal.toLocaleString()}$</p>
                            <p class="text-sm text-gray-500">Ce mois</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total</h3>
                            <p class="text-2xl font-bold text-purple-600">${(kpis.coutMatiereTotal + kpis.coutMainOeuvreTotal).toLocaleString()}$</p>
                            <p class="text-sm text-gray-500">Ce mois</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">D√©tail Main d'≈íuvre</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employ√©</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Poste</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Taux/h</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Heures</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Co√ªt Total</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${mainOeuvre.map(mo => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${mo.employe}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mo.poste}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mo.tauxHoraire}$/h</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mo.heuresTravaillees}h</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${mo.coutTotal.toLocaleString()}$</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRapports() {
            return `
                <div class="space-y-6">
                    <h2 class="text-3xl font-bold text-gray-800">Rapports & Analyses</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Rentabilit√© par Produit</h3>
                            <div class="space-y-4">
                                ${productions.map(prod => {
                                    const coutTotal = prod.coutMatiere + prod.coutMainOeuvre;
                                    const coutUnitaire = coutTotal / prod.quantite;
                                    const prixVenteEstime = coutUnitaire * 1.5;
                                    const beneficeUnitaire = prixVenteEstime - coutUnitaire;
                                    
                                    return `
                                        <div class="border rounded-lg p-4">
                                            <h4 class="font-medium text-gray-800">${prod.produit}</h4>
                                            <div class="mt-2 space-y-1 text-sm">
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600">Co√ªt unitaire:</span>
                                                    <span>${Math.round(coutUnitaire)}$</span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600">Prix de vente estim√©:</span>
                                                    <span>${Math.round(prixVenteEstime)}$</span>
                                                </div>
                                                <div class="flex justify-between font-medium">
                                                    <span class="text-gray-800">B√©n√©fice unitaire:</span>
                                                    <span class="text-green-600">+${Math.round(beneficeUnitaire)}$</span>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Performance Mensuelle</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                    <span class="text-gray-700">Productions termin√©es</span>
                                    <span class="font-bold text-blue-600">${productions.filter(p => p.statut === 'Termin√©').length}</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                    <span class="text-gray-700">Valeur produite</span>
                                    <span class="font-bold text-green-600">
                                        ${productions
                                            .filter(p => p.statut === 'Termin√©')
                                            .reduce((sum, p) => sum + (p.coutMatiere + p.coutMainOeuvre), 0)
                                            .toLocaleString()}$
                                    </span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                                    <span class="text-gray-700">Efficacit√© moyenne</span>
                                    <span class="font-bold text-purple-600">92%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderModal() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold mb-6">
                                ${modalType === 'production' ? 'Nouvel Ordre de Production' : 'Nouvel Article Inventaire'}
                            </h3>
                            
                            <form id="modalForm" class="space-y-4">
                                ${modalType === 'inventaire' ? `
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <input name="nom" type="text" placeholder="Nom de l'article" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                        <select name="categorie" class="w-full p-3 border border-gray-300 rounded-lg" required>
                                            <option value="">S√©lectionner cat√©gorie</option>
                                            <option value="Mati√®re Premi√®re">Mati√®re Premi√®re</option>
                                            <option value="Composants">Composants</option>
                                            <option value="Finition">Finition</option>
                                            <option value="Produit Fini">Produit Fini</option>
                                        </select>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <input name="quantite" type="number" placeholder="Quantit√©" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                        <input name="unite" type="text" placeholder="Unit√© (kg, pcs, L...)" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                        <input name="prixUnitaire" type="number" step="0.01" placeholder="Prix unitaire" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                    </div>
                                    
                                    <input name="fournisseurPrincipal" type="text" placeholder="Fournisseur principal" class="w-full p-3 border border-gray-300 rounded-lg" />
                                    <textarea name="description" placeholder="Description" class="w-full p-3 border border-gray-300 rounded-lg h-20"></textarea>
                                ` : `
                                    <input name="produit" type="text" placeholder="Nom du produit" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                    <input name="quantite" type="number" placeholder="Quantit√©" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                    <input name="dateDebut" type="date" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                    <input name="coutMatiere" type="number" placeholder="Co√ªt mati√®re" class="w-full p-3 border border-gray-300 rounded-lg" />
                                `}
                            </form>
                            
                            <div class="flex space-x-3 mt-6">
                                <button onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    Annuler
                                </button>
                                <button onclick="submitForm()" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    Cr√©er
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderItemDetail() {
            if (!selectedItem) return '';
            
            // Variables pour l'√©tat de l'√©dition
            let editMode = false;
            let activeTab = 'general';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[95vh] overflow-y-auto">
                        <div class="flex flex-col h-full">
                            <!-- Header -->
                            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                                <div>
                                    <h3 class="text-2xl font-semibold text-gray-800">${selectedItem.nom}</h3>
                                    <p class="text-gray-600">${selectedItem.categorie} ‚Ä¢ ${selectedItem.quantite} ${selectedItem.unite} disponible</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="enableEditMode()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2">
                                        <span>‚úèÔ∏è</span><span>Modifier</span>
                                    </button>
                                    <button onclick="duplicateItem(${selectedItem.id})" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2">
                                        <span>üìã</span><span>Dupliquer</span>
                                    </button>
                                    <button onclick="closeItemDetail()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                        Fermer
                                    </button>
                                </div>
                            </div>

                            <!-- Onglets -->
                            <div class="border-b border-gray-200">
                                <div class="flex space-x-0">
                                    <button onclick="setActiveTab('general')" class="px-6 py-3 border-b-2 font-medium text-sm ${activeTab === 'general' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üìã G√©n√©ral
                                    </button>
                                    <button onclick="setActiveTab('nomenclatures')" class="px-6 py-3 border-b-2 font-medium text-sm ${activeTab === 'nomenclatures' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üîß Nomenclatures
                                    </button>
                                    <button onclick="setActiveTab('variantes')" class="px-6 py-3 border-b-2 font-medium text-sm ${activeTab === 'variantes' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üé® Variantes
                                    </button>
                                    <button onclick="setActiveTab('fournisseurs')" class="px-6 py-3 border-b-2 font-medium text-sm ${activeTab === 'fournisseurs' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üè™ Fournisseurs
                                    </button>
                                    <button onclick="setActiveTab('stocks')" class="px-6 py-3 border-b-2 font-medium text-sm ${activeTab === 'stocks' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                                        üìä Stocks & Co√ªts
                                    </button>
                                </div>
                            </div>

                            <!-- Contenu des onglets -->
                            <div class="flex-1 p-6">
                                ${renderTabContent(activeTab)}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scripts pour la gestion des onglets -->
                <script>
                    function setActiveTab(tab) {
                        // Mise √† jour de l'onglet actif et re-render
                        const event = new CustomEvent('tabChange', { detail: { tab: tab, itemId: ${selectedItem.id} } });
                        document.dispatchEvent(event);
                    }
                    
                    function enableEditMode() {
                        // Activer le mode √©dition
                        const event = new CustomEvent('enableEdit', { detail: { itemId: ${selectedItem.id} } });
                        document.dispatchEvent(event);
                    }
                    
                    // √âcouter les √©v√©nements personnalis√©s
                    document.addEventListener('tabChange', function(e) {
                        activeTab = e.detail.tab;
                        renderApp();
                    });
                    
                    document.addEventListener('enableEdit', function(e) {
                        editMode = true;
                        renderApp();
                    });
                </script>
            `;
        }

        function renderTabContent(activeTab) {
            switch(activeTab) {
                case 'general':
                    return renderGeneralTab();
                case 'nomenclatures':
                    return renderNomenclaturesTab();
                case 'variantes':
                    return renderVariantesTab();
                case 'fournisseurs':
                    return renderFournisseursTab();
                case 'stocks':
                    return renderStocksTab();
                default:
                    return renderGeneralTab();
            }
        }

        function renderGeneralTab() {
            return `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Informations de base -->
                    <div class="space-y-6">
                        <h4 class="text-lg font-semibold text-gray-800 border-b pb-2">Informations G√©n√©rales</h4>
                        
                        <form id="editGeneralForm" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nom du produit</label>
                                    <input type="text" value="${selectedItem.nom}" name="nom" class="w-full p-3 border border-gray-300 rounded-lg" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cat√©gorie</label>
                                    <select name="categorie" class="w-full p-3 border border-gray-300 rounded-lg">
                                        <option value="Mati√®re Premi√®re" ${selectedItem.categorie === 'Mati√®re Premi√®re' ? 'selected' : ''}>Mati√®re Premi√®re</option>
                                        <option value="Composants" ${selectedItem.categorie === 'Composants' ? 'selected' : ''}>Composants</option>
                                        <option value="Finition" ${selectedItem.categorie === 'Finition' ? 'selected' : ''}>Finition</option>
                                        <option value="Produit Fini" ${selectedItem.categorie === 'Produit Fini' ? 'selected' : ''}>Produit Fini</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Stock actuel</label>
                                    <input type="number" value="${selectedItem.quantite}" name="quantite" class="w-full p-3 border border-gray-300 rounded-lg" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Unit√©</label>
                                    <input type="text" value="${selectedItem.unite}" name="unite" class="w-full p-3 border border-gray-300 rounded-lg" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Prix unitaire</label>
                                    <input type="number" step="0.01" value="${selectedItem.prixUnitaire}" name="prixUnitaire" class="w-full p-3 border border-gray-300 rounded-lg" />
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full p-3 border border-gray-300 rounded-lg">${selectedItem.description || ''}</textarea>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button type="button" onclick="saveGeneralChanges()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    Sauvegarder
                                </button>
                                <button type="button" onclick="resetGeneralForm()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    Annuler
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Attributs et statut -->
                    <div class="space-y-6">
                        <h4 class="text-lg font-semibold text-gray-800 border-b pb-2">Attributs & Statut</h4>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h5 class="font-medium text-gray-800 mb-3">Attributs configurables</h5>
                            <div class="space-y-2">
                                ${selectedItem.attributs?.map(attr => `
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-700">${attr}</span>
                                        <button onclick="removeAttribute('${attr}')" class="text-red-600 hover:text-red-800 text-sm">Supprimer</button>
                                    </div>
                                `).join('') || '<p class="text-gray-500">Aucun attribut d√©fini</p>'}
                            </div>
                            <div class="mt-3 flex space-x-2">
                                <input type="text" id="newAttribute" placeholder="Nouvel attribut" class="flex-1 p-2 border border-gray-300 rounded text-sm" />
                                <button onclick="addAttribute()" class="px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">Ajouter</button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Valeur totale</p>
                                <p class="text-2xl font-bold text-blue-600">${selectedItem.valeur.toLocaleString()}$</p>
                            </div>
                            <div class="bg-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Statut stock</p>
                                <p class="text-lg font-bold text-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-600">
                                    ${selectedItem.quantite <= selectedItem.seuilMin ? '‚ö†Ô∏è Stock Bas' : '‚úÖ Stock OK'}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderNomenclaturesTab() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-semibold text-gray-800">Nomenclatures (BoM)</h4>
                        <button onclick="addNomenclature()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2">
                            <span>‚ûï</span><span>Nouvelle Nomenclature</span>
                        </button>
                    </div>
                    
                    ${selectedItem.nomenclatures?.length > 0 ? `
                        <div class="space-y-4">
                            ${selectedItem.nomenclatures.map((nomenclature, index) => `
                                <div class="border rounded-lg ${nomenclature.active ? 'border-green-300 bg-green-50' : 'border-gray-300 bg-white'}">
                                    <div class="p-4 border-b border-gray-200">
                                        <div class="flex justify-between items-center">
                                            <div class="flex items-center space-x-4">
                                                <h5 class="font-semibold text-gray-800">${nomenclature.nom}</h5>
                                                <span class="px-2 py-1 rounded text-xs ${nomenclature.active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'}">
                                                    ${nomenclature.active ? 'Active' : 'Inactive'}
                                                </span>
                                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">${nomenclature.type}</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button onclick="toggleNomenclature(${nomenclature.id})" class="px-3 py-1 text-sm ${nomenclature.active ? 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200' : 'bg-green-100 text-green-800 hover:bg-green-200'} rounded">
                                                    ${nomenclature.active ? 'D√©sactiver' : 'Activer'}
                                                </button>
                                                <button onclick="deleteNomenclature(${nomenclature.id})" class="px-3 py-1 text-sm bg-red-100 text-red-800 hover:bg-red-200 rounded">Supprimer</button>
                                            </div>
                                        </div>
                                        <div class="mt-2 grid grid-cols-3 gap-4 text-sm">
                                            <div>
                                                <span class="text-gray-600">Co√ªt total: </span>
                                                <span class="font-semibold">${nomenclature.coutTotal?.toFixed(2)}$</span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600">Temps production: </span>
                                                <span class="font-semibold">${nomenclature.tempsProduction}h</span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600">Composants: </span>
                                                <span class="font-semibold">${nomenclature.composants?.length || 0}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Liste des composants -->
                                    <div class="p-4">
                                        <h6 class="font-medium text-gray-700 mb-3">Composants requis</h6>
                                        <div class="overflow-x-auto">
                                            <table class="min-w-full text-sm">
                                                <thead class="bg-gray-50">
                                                    <tr>
                                                        <th class="text-left p-2">Composant</th>
                                                        <th class="text-left p-2">Quantit√©</th>
                                                        <th class="text-left p-2">Unit√©</th>
                                                        <th class="text-left p-2">Co√ªt</th>
                                                        <th class="text-left p-2">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${nomenclature.composants?.map((composant, compIndex) => `
                                                        <tr class="border-t">
                                                            <td class="p-2 font-medium">${composant.composant}</td>
                                                            <td class="p-2">${composant.quantite}</td>
                                                            <td class="p-2">${composant.unite}</td>
                                                            <td class="p-2">${composant.cout?.toFixed(2)}$</td>
                                                            <td class="p-2">
                                                                <button onclick="removeComposant(${nomenclature.id}, ${compIndex})" class="text-red-600 hover:text-red-800">üóëÔ∏è</button>
                                                            </td>
                                                        </tr>
                                                    `).join('') || '<tr><td colspan="5" class="p-2 text-gray-500 text-center">Aucun composant d√©fini</td></tr>'}
                                                </tbody>
                                            </table>
                                        </div>
                                        <button onclick="addComposant(${nomenclature.id})" class="mt-3 px-3 py-1 bg-blue-100 text-blue-800 rounded text-sm hover:bg-blue-200">
                                            + Ajouter Composant
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-12">
                            <div class="text-6xl text-gray-300 mb-4">üîß</div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Aucune nomenclature d√©finie</h3>
                            <p class="text-gray-500 mb-6">Cr√©ez une nomenclature pour d√©finir les composants n√©cessaires √† la fabrication de ce produit.</p>
                            <button onclick="addNomenclature()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                Cr√©er la premi√®re nomenclature
                            </button>
                        </div>
                    `}
                </div>
            `;
        }

        function renderVariantesTab() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-semibold text-gray-800">Variantes de produit</h4>
                        <button onclick="addVariante()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center space-x-2">
                            <span>‚ûï</span><span>Nouvelle Variante</span>
                        </button>
                    </div>
                    
                    ${selectedItem.variantes?.length > 0 ? `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            ${selectedItem.variantes.map(variante => `
                                <div class="border rounded-lg p-6 hover:shadow-md transition-shadow">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h5 class="font-semibold text-gray-800">${variante.nom}</h5>
                                            <div class="mt-2 space-y-1">
                                                ${Object.entries(variante.attributs || {}).map(([key, value]) => `
                                                    <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs mr-2">
                                                        ${key}: ${value}
                                                    </span>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div class="flex space-x-1">
                                            <button onclick="deleteVariante(${variante.id})" class="text-red-600 hover:text-red-800">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <span class="text-gray-600">Stock: </span>
                                            <span class="font-semibold ${variante.stock <= 5 ? 'text-red-600' : 'text-green-600'}">${variante.stock} ${selectedItem.unite}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">Prix: </span>
                                            <span class="font-semibold text-green-600">${variante.prix}$</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4 flex space-x-2">
                                        <button onclick="adjustStock(${variante.id}, 'add')" class="px-3 py-1 bg-green-100 text-green-800 rounded text-sm hover:bg-green-200">+ Stock</button>
                                        <button onclick="adjustStock(${variante.id}, 'remove')" class="px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200">- Stock</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-12">
                            <div class="text-6xl text-gray-300 mb-4">üé®</div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Aucune variante d√©finie</h3>
                            <p class="text-gray-500 mb-6">Cr√©ez des variantes pour ce produit (couleurs, tailles, finitions, etc.)</p>
                            <button onclick="addVariante()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                Cr√©er la premi√®re variante
                            </button>
                        </div>
                    `}
                    
                    <!-- R√©sum√© des variantes -->
                    ${selectedItem.variantes?.length > 0 ? `
                        <div class="mt-8 bg-gray-50 rounded-lg p-6">
                            <h5 class="font-semibold text-gray-800 mb-4">R√©sum√© des variantes</h5>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-600">Total variantes</p>
                                    <p class="text-2xl font-bold text-blue-600">${selectedItem.variantes.length}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Stock total</p>
                                    <p class="text-2xl font-bold text-green-600">${selectedItem.variantes.reduce((sum, v) => sum + v.stock, 0)}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Prix min</p>
                                    <p class="text-2xl font-bold text-purple-600">${Math.min(...selectedItem.variantes.map(v => v.prix))}$</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Prix max</p>
                                    <p class="text-2xl font-bold text-purple-600">${Math.max(...selectedItem.variantes.map(v => v.prix))}$</p>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderFournisseursTab() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-semibold text-gray-800">Fournisseurs</h4>
                        <button onclick="addFournisseur()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2">
                            <span>‚ûï</span><span>Nouveau Fournisseur</span>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        ${selectedItem.fournisseurs?.map((fournisseur, index) => `
                            <div class="border rounded-lg p-6 ${index === 0 ? 'border-blue-300 bg-blue-50' : 'border-gray-200'}">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h5 class="font-semibold text-gray-800">${fournisseur.nom}</h5>
                                        ${index === 0 ? '<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">Fournisseur Principal</span>' : ''}
                                    </div>
                                    <div class="flex space-x-1">
                                        ${index !== 0 ? `<button onclick="setMainSupplier(${index})" class="text-green-600 hover:text-green-800" title="D√©finir comme principal">‚≠ê</button>` : ''}
                                        ${selectedItem.fournisseurs.length > 1 ? `<button onclick="deleteFournisseur(${index})" class="text-red-600 hover:text-red-800">üóëÔ∏è</button>` : ''}
                                    </div>
                                </div>
                                
                                <div class="space-y-3 text-sm">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <span class="text-gray-600">Prix: </span>
                                            <span class="font-semibold text-green-600">${fournisseur.prix}$ / ${selectedItem.unite}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">D√©lai: </span>
                                            <span class="font-semibold">${fournisseur.delai}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="pt-3 border-t border-gray-200">
                                        <button onclick="createPurchaseOrder(${index})" class="px-4 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700 mr-2">
                                            üì¶ Cr√©er commande
                                        </button>
                                        <button onclick="viewSupplierHistory(${index})" class="px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50">
                                            üìä Historique
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Comparaison des fournisseurs -->
                    ${selectedItem.fournisseurs?.length > 1 ? `
                        <div class="mt-8">
                            <h5 class="font-semibold text-gray-800 mb-4">Comparaison des fournisseurs</h5>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-200 rounded-lg">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="text-left p-3 font-medium">Fournisseur</th>
                                            <th class="text-left p-3 font-medium">Prix</th>
                                            <th class="text-left p-3 font-medium">D√©lai</th>
                                            <th class="text-left p-3 font-medium">√âconomies</th>
                                            <th class="text-left p-3 font-medium">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${selectedItem.fournisseurs.map((fournisseur, index) => {
                                            const prixMin = Math.min(...selectedItem.fournisseurs.map(f => f.prix));
                                            const economies = fournisseur.prix - prixMin;
                                            return `
                                                <tr class="border-t ${index === 0 ? 'bg-blue-50' : ''}">
                                                    <td class="p-3">
                                                        ${fournisseur.nom}
                                                        ${index === 0 ? '<span class="ml-2 px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">Principal</span>' : ''}
                                                    </td>
                                                    <td class="p-3 font-semibold ${fournisseur.prix === prixMin ? 'text-green-600' : ''}">${fournisseur.prix}$</td>
                                                    <td class="p-3">${fournisseur.delai}</td>
                                                    <td class="p-3">
                                                        ${economies === 0 ? 
                                                            '<span class="text-green-600 font-semibold">Meilleur prix</span>' : 
                                                            `<span class="text-red-600">+${economies.toFixed(2)}$</span>`
                                                        }
                                                    </td>
                                                    <td class="p-3">
                                                        ${index !== 0 && fournisseur.prix === prixMin ? 
                                                            '<button onclick="setMainSupplier(' + index + ')" class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs hover:bg-green-200">Choisir</button>' : 
                                                            ''
                                                        }
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderStocksTab() {
            const stockVariantes = selectedItem.variantes?.reduce((sum, v) => sum + v.stock, 0) || 0;
            const stockTotal = selectedItem.quantite + stockVariantes;
            
            return `
                <div class="space-y-6">
                    <h4 class="text-lg font-semibold text-gray-800">Gestion des Stocks & Co√ªts</h4>
                    
                    <!-- KPIs Stocks -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <h5 class="font-medium text-blue-800">Stock Principal</h5>
                            <p class="text-2xl font-bold text-blue-600">${selectedItem.quantite}</p>
                            <p class="text-sm text-blue-600">${selectedItem.unite}</p>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                            <h5 class="font-medium text-purple-800">Stock Variantes</h5>
                            <p class="text-2xl font-bold text-purple-600">${stockVariantes}</p>
                            <p class="text-sm text-purple-600">${selectedItem.unite}</p>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                            <h5 class="font-medium text-green-800">Stock Total</h5>
                            <p class="text-2xl font-bold text-green-600">${stockTotal}</p>
                            <p class="text-sm text-green-600">${selectedItem.unite}</p>
                        </div>
                        <div class="bg-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-50 border border-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-200 rounded-lg p-6">
                            <h5 class="font-medium text-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-800">Statut</h5>
                            <p class="text-lg font-bold text-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-600">
                                ${selectedItem.quantite <= selectedItem.seuilMin ? 'Stock Bas' : 'Stock OK'}
                            </p>
                            <p class="text-sm text-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-600">Seuil: ${selectedItem.seuilMin}</p>
                        </div>
                    </div>
                    
                    <!-- Ajustements de stock -->
                    <div class="bg-white border rounded-lg p-6">
                        <h5 class="font-semibold text-gray-800 mb-4">Ajustements de Stock</h5>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Type d'ajustement</label>
                                <select id="adjustmentType" class="w-full p-3 border border-gray-300 rounded-lg">
                                    <option value="manual">Ajustement manuel</option>
                                    <option value="reception">R√©ception marchandise</option>
                                    <option value="production">Production interne</option>
                                    <option value="perte">Perte/Casse</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Quantit√©</label>
                                <input type="number" id="adjustmentQuantity" placeholder="Quantit√© √† ajouter/retirer" class="w-full p-3 border border-gray-300 rounded-lg" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Action</label>
                                <div class="flex space-x-2">
                                    <button onclick="adjustStock('add')" class="flex-1 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">+ Ajouter</button>
                                    <button onclick="adjustStock('remove')" class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700">- Retirer</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Motif (optionnel)</label>
                            <input type="text" id="adjustmentReason" placeholder="Raison de l'ajustement" class="w-full p-3 border border-gray-300 rounded-lg" />
                        </div>
                    </div>
                </div>
            `;
        }
            return `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Informations de base -->
                    <div class="space-y-6">
                        <h4 class="text-lg font-semibold text-gray-800 border-b pb-2">Informations G√©n√©rales</h4>
                        
                        <form id="editGeneralForm" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nom du produit</label>
                                    <input type="text" value="${selectedItem.nom}" name="nom" class="w-full p-3 border border-gray-300 rounded-lg" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cat√©gorie</label>
                                    <select name="categorie" class="w-full p-3 border border-gray-300 rounded-lg">
                                        <option value="Mati√®re Premi√®re" ${selectedItem.categorie === 'Mati√®re Premi√®re' ? 'selected' : ''}>Mati√®re Premi√®re</option>
                                        <option value="Composants" ${selectedItem.categorie === 'Composants' ? 'selected' : ''}>Composants</option>
                                        <option value="Finition" ${selectedItem.categorie === 'Finition' ? 'selected' : ''}>Finition</option>
                                        <option value="Produit Fini" ${selectedItem.categorie === 'Produit Fini' ? 'selected' : ''}>Produit Fini</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Stock actuel</label>
                                    <input type="number" value="${selectedItem.quantite}" name="quantite" class="w-full p-3 border border-gray-300 rounded-lg" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Unit√©</label>
                                    <input type="text" value="${selectedItem.unite}" name="unite" class="w-full p-3 border border-gray-300 rounded-lg" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Prix unitaire</label>
                                    <input type="number" step="0.01" value="${selectedItem.prixUnitaire}" name="prixUnitaire" class="w-full p-3 border border-gray-300 rounded-lg" />
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full p-3 border border-gray-300 rounded-lg">${selectedItem.description || ''}</textarea>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button type="button" onclick="saveGeneralChanges()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    Sauvegarder
                                </button>
                                <button type="button" onclick="resetGeneralForm()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    Annuler
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Attributs et statut -->
                    <div class="space-y-6">
                        <h4 class="text-lg font-semibold text-gray-800 border-b pb-2">Attributs & Statut</h4>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h5 class="font-medium text-gray-800 mb-3">Attributs configurables</h5>
                            <div class="space-y-2">
                                ${selectedItem.attributs?.map(attr => `
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-700">${attr}</span>
                                        <button onclick="removeAttribute('${attr}')" class="text-red-600 hover:text-red-800 text-sm">Supprimer</button>
                                    </div>
                                `).join('') || '<p class="text-gray-500">Aucun attribut d√©fini</p>'}
                            </div>
                            <div class="mt-3 flex space-x-2">
                                <input type="text" id="newAttribute" placeholder="Nouvel attribut" class="flex-1 p-2 border border-gray-300 rounded text-sm" />
                                <button onclick="addAttribute()" class="px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">Ajouter</button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Valeur totale</p>
                                <p class="text-2xl font-bold text-blue-600">${selectedItem.valeur.toLocaleString()}$</p>
                            </div>
                            <div class="bg-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">Statut stock</p>
                                <p class="text-lg font-bold text-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-600">
                                    ${selectedItem.quantite <= selectedItem.seuilMin ? '‚ö†Ô∏è Stock Bas' : '‚úÖ Stock OK'}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderNomenclaturesTab() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-semibold text-gray-800">Nomenclatures (BoM)</h4>
                        <button onclick="addNomenclature()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2">
                            <span>‚ûï</span><span>Nouvelle Nomenclature</span>
                        </button>
                    </div>
                    
                    ${selectedItem.nomenclatures?.length > 0 ? `
                        <div class="space-y-4">
                            ${selectedItem.nomenclatures.map((nomenclature, index) => `
                                <div class="border rounded-lg ${nomenclature.active ? 'border-green-300 bg-green-50' : 'border-gray-300 bg-white'}">
                                    <div class="p-4 border-b border-gray-200">
                                        <div class="flex justify-between items-center">
                                            <div class="flex items-center space-x-4">
                                                <h5 class="font-semibold text-gray-800">${nomenclature.nom}</h5>
                                                <span class="px-2 py-1 rounded text-xs ${nomenclature.active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'}">
                                                    ${nomenclature.active ? 'Active' : 'Inactive'}
                                                </span>
                                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">${nomenclature.type}</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button onclick="toggleNomenclature(${nomenclature.id})" class="px-3 py-1 text-sm ${nomenclature.active ? 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200' : 'bg-green-100 text-green-800 hover:bg-green-200'} rounded">
                                                    ${nomenclature.active ? 'D√©sactiver' : 'Activer'}
                                                </button>
                                                <button onclick="editNomenclature(${nomenclature.id})" class="px-3 py-1 text-sm bg-blue-100 text-blue-800 hover:bg-blue-200 rounded">Modifier</button>
                                                <button onclick="deleteNomenclature(${nomenclature.id})" class="px-3 py-1 text-sm bg-red-100 text-red-800 hover:bg-red-200 rounded">Supprimer</button>
                                            </div>
                                        </div>
                                        <div class="mt-2 grid grid-cols-3 gap-4 text-sm">
                                            <div>
                                                <span class="text-gray-600">Co√ªt total: </span>
                                                <span class="font-semibold">${nomenclature.coutTotal?.toFixed(2)}$</span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600">Temps production: </span>
                                                <span class="font-semibold">${nomenclature.tempsProduction}h</span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600">Composants: </span>
                                                <span class="font-semibold">${nomenclature.composants?.length || 0}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Liste des composants -->
                                    <div class="p-4">
                                        <h6 class="font-medium text-gray-700 mb-3">Composants requis</h6>
                                        <div class="overflow-x-auto">
                                            <table class="min-w-full text-sm">
                                                <thead class="bg-gray-50">
                                                    <tr>
                                                        <th class="text-left p-2">Composant</th>
                                                        <th class="text-left p-2">Quantit√©</th>
                                                        <th class="text-left p-2">Unit√©</th>
                                                        <th class="text-left p-2">Co√ªt</th>
                                                        <th class="text-left p-2">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${nomenclature.composants?.map((composant, compIndex) => `
                                                        <tr class="border-t">
                                                            <td class="p-2 font-medium">${composant.composant}</td>
                                                            <td class="p-2">${composant.quantite}</td>
                                                            <td class="p-2">${composant.unite}</td>
                                                            <td class="p-2">${composant.cout?.toFixed(2)}$</td>
                                                            <td class="p-2">
                                                                <button onclick="editComposant(${nomenclature.id}, ${compIndex})" class="text-blue-600 hover:text-blue-800 mr-2">‚úèÔ∏è</button>
                                                                <button onclick="removeComposant(${nomenclature.id}, ${compIndex})" class="text-red-600 hover:text-red-800">üóëÔ∏è</button>
                                                            </td>
                                                        </tr>
                                                    `).join('') || '<tr><td colspan="5" class="p-2 text-gray-500 text-center">Aucun composant d√©fini</td></tr>'}
                                                </tbody>
                                            </table>
                                        </div>
                                        <button onclick="addComposant(${nomenclature.id})" class="mt-3 px-3 py-1 bg-blue-100 text-blue-800 rounded text-sm hover:bg-blue-200">
                                            + Ajouter Composant
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-12">
                            <div class="text-6xl text-gray-300 mb-4">üîß</div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Aucune nomenclature d√©finie</h3>
                            <p class="text-gray-500 mb-6">Cr√©ez une nomenclature pour d√©finir les composants n√©cessaires √† la fabrication de ce produit.</p>
                            <button onclick="addNomenclature()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                Cr√©er la premi√®re nomenclature
                            </button>
                        </div>
                    `}
                </div>
            `;
        }

        function renderVariantesTab() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-semibold text-gray-800">Variantes de produit</h4>
                        <button onclick="addVariante()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center space-x-2">
                            <span>‚ûï</span><span>Nouvelle Variante</span>
                        </button>
                    </div>
                    
                    ${selectedItem.variantes?.length > 0 ? `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            ${selectedItem.variantes.map(variante => `
                                <div class="border rounded-lg p-6 hover:shadow-md transition-shadow">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h5 class="font-semibold text-gray-800">${variante.nom}</h5>
                                            <div class="mt-2 space-y-1">
                                                ${Object.entries(variante.attributs || {}).map(([key, value]) => `
                                                    <span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs mr-2">
                                                        ${key}: ${value}
                                                    </span>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div class="flex space-x-1">
                                            <button onclick="editVariante(${variante.id})" class="text-blue-600 hover:text-blue-800">‚úèÔ∏è</button>
                                            <button onclick="deleteVariante(${variante.id})" class="text-red-600 hover:text-red-800">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <span class="text-gray-600">Stock: </span>
                                            <span class="font-semibold ${variante.stock <= 5 ? 'text-red-600' : 'text-green-600'}">${variante.stock} ${selectedItem.unite}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">Prix: </span>
                                            <span class="font-semibold text-green-600">${variante.prix}$</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4 flex space-x-2">
                                        <button onclick="adjustStock(${variante.id}, 'add')" class="px-3 py-1 bg-green-100 text-green-800 rounded text-sm hover:bg-green-200">+ Stock</button>
                                        <button onclick="adjustStock(${variante.id}, 'remove')" class="px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200">- Stock</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-12">
                            <div class="text-6xl text-gray-300 mb-4">üé®</div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Aucune variante d√©finie</h3>
                            <p class="text-gray-500 mb-6">Cr√©ez des variantes pour ce produit (couleurs, tailles, finitions, etc.)</p>
                            <button onclick="addVariante()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                Cr√©er la premi√®re variante
                            </button>
                        </div>
                    `}
                    
                    <!-- R√©sum√© des variantes -->
                    ${selectedItem.variantes?.length > 0 ? `
                        <div class="mt-8 bg-gray-50 rounded-lg p-6">
                            <h5 class="font-semibold text-gray-800 mb-4">R√©sum√© des variantes</h5>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-600">Total variantes</p>
                                    <p class="text-2xl font-bold text-blue-600">${selectedItem.variantes.length}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Stock total</p>
                                    <p class="text-2xl font-bold text-green-600">${selectedItem.variantes.reduce((sum, v) => sum + v.stock, 0)}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Prix min</p>
                                    <p class="text-2xl font-bold text-purple-600">${Math.min(...selectedItem.variantes.map(v => v.prix))}$</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Prix max</p>
                                    <p class="text-2xl font-bold text-purple-600">${Math.max(...selectedItem.variantes.map(v => v.prix))}$</p>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderFournisseursTab() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-semibold text-gray-800">Fournisseurs</h4>
                        <button onclick="addFournisseur()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2">
                            <span>‚ûï</span><span>Nouveau Fournisseur</span>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        ${selectedItem.fournisseurs?.map((fournisseur, index) => `
                            <div class="border rounded-lg p-6 ${index === 0 ? 'border-blue-300 bg-blue-50' : 'border-gray-200'}">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h5 class="font-semibold text-gray-800">${fournisseur.nom}</h5>
                                        ${index === 0 ? '<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">Fournisseur Principal</span>' : ''}
                                    </div>
                                    <div class="flex space-x-1">
                                        ${index !== 0 ? `<button onclick="setMainSupplier(${index})" class="text-green-600 hover:text-green-800" title="D√©finir comme principal">‚≠ê</button>` : ''}
                                        <button onclick="editFournisseur(${index})" class="text-blue-600 hover:text-blue-800">‚úèÔ∏è</button>
                                        ${selectedItem.fournisseurs.length > 1 ? `<button onclick="deleteFournisseur(${index})" class="text-red-600 hover:text-red-800">üóëÔ∏è</button>` : ''}
                                    </div>
                                </div>
                                
                                <div class="space-y-3 text-sm">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <span class="text-gray-600">Prix: </span>
                                            <span class="font-semibold text-green-600">${fournisseur.prix}$ / ${selectedItem.unite}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">D√©lai: </span>
                                            <span class="font-semibold">${fournisseur.delai}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="pt-3 border-t border-gray-200">
                                        <button onclick="createPurchaseOrder(${index})" class="px-4 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700 mr-2">
                                            üì¶ Cr√©er commande
                                        </button>
                                        <button onclick="viewSupplierHistory(${index})" class="px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50">
                                            üìä Historique
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Comparaison des fournisseurs -->
                    ${selectedItem.fournisseurs?.length > 1 ? `
                        <div class="mt-8">
                            <h5 class="font-semibold text-gray-800 mb-4">Comparaison des fournisseurs</h5>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-200 rounded-lg">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="text-left p-3 font-medium">Fournisseur</th>
                                            <th class="text-left p-3 font-medium">Prix</th>
                                            <th class="text-left p-3 font-medium">D√©lai</th>
                                            <th class="text-left p-3 font-medium">√âconomies</th>
                                            <th class="text-left p-3 font-medium">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${selectedItem.fournisseurs.map((fournisseur, index) => {
                                            const prixMin = Math.min(...selectedItem.fournisseurs.map(f => f.prix));
                                            const economies = fournisseur.prix - prixMin;
                                            return `
                                                <tr class="border-t ${index === 0 ? 'bg-blue-50' : ''}">
                                                    <td class="p-3">
                                                        ${fournisseur.nom}
                                                        ${index === 0 ? '<span class="ml-2 px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">Principal</span>' : ''}
                                                    </td>
                                                    <td class="p-3 font-semibold ${fournisseur.prix === prixMin ? 'text-green-600' : ''}">${fournisseur.prix}$</td>
                                                    <td class="p-3">${fournisseur.delai}</td>
                                                    <td class="p-3">
                                                        ${economies === 0 ? 
                                                            '<span class="text-green-600 font-semibold">Meilleur prix</span>' : 
                                                            `<span class="text-red-600">+${economies.toFixed(2)}$</span>`
                                                        }
                                                    </td>
                                                    <td class="p-3">
                                                        ${index !== 0 && fournisseur.prix === prixMin ? 
                                                            '<button onclick="setMainSupplier(' + index + ')" class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs hover:bg-green-200">Choisir</button>' : 
                                                            ''
                                                        }
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderStocksTab() {
            const stockVariantes = selectedItem.variantes?.reduce((sum, v) => sum + v.stock, 0) || 0;
            const stockTotal = selectedItem.quantite + stockVariantes;
            
            return `
                <div class="space-y-6">
                    <h4 class="text-lg font-semibold text-gray-800">Gestion des Stocks & Co√ªts</h4>
                    
                    <!-- KPIs Stocks -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <h5 class="font-medium text-blue-800">Stock Principal</h5>
                            <p class="text-2xl font-bold text-blue-600">${selectedItem.quantite}</p>
                            <p class="text-sm text-blue-600">${selectedItem.unite}</p>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                            <h5 class="font-medium text-purple-800">Stock Variantes</h5>
                            <p class="text-2xl font-bold text-purple-600">${stockVariantes}</p>
                            <p class="text-sm text-purple-600">${selectedItem.unite}</p>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                            <h5 class="font-medium text-green-800">Stock Total</h5>
                            <p class="text-2xl font-bold text-green-600">${stockTotal}</p>
                            <p class="text-sm text-green-600">${selectedItem.unite}</p>
                        </div>
                        <div class="bg-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-50 border border-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-200 rounded-lg p-6">
                            <h5 class="font-medium text-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-800">Statut</h5>
                            <p class="text-lg font-bold text-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-600">
                                ${selectedItem.quantite <= selectedItem.seuilMin ? 'Stock Bas' : 'Stock OK'}
                            </p>
                            <p class="text-sm text-${selectedItem.quantite <= selectedItem.seuilMin ? 'red' : 'green'}-600">Seuil: ${selectedItem.seuilMin}</p>
                        </div>
                    </div>
                    
                    <!-- Ajustements de stock -->
                    <div class="bg-white border rounded-lg p-6">
                        <h5 class="font-semibold text-gray-800 mb-4">Ajustements de Stock</h5>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Type d'ajustement</label>
                                <select id="adjustmentType" class="w-full p-3 border border-gray-300 rounded-lg">
                                    <option value="manual">Ajustement manuel</option>
                                    <option value="reception">R√©ception marchandise</option>
                                    <option value="production">Production interne</option>
                                    <option value="perte">Perte/Casse</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Quantit√©</label>
                                <input type="number" id="adjustmentQuantity" placeholder="Quantit√© √† ajouter/retirer" class="w-full p-3 border border-gray-300 rounded-lg" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Action</label>
                                <div class="flex space-x-2">
                                    <button onclick="adjustStock('add')" class="flex-1 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">+ Ajouter</button>
                                    <button onclick="adjustStock('remove')" class="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700">- Retirer</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Motif (optionnel)</label>
                            <input type="text" id="adjustmentReason" placeholder="Raison de l'ajustement" class="w-full p-3 border border-gray-300 rounded-lg" />
                        </div>
                    </div>
                    
                    <!-- Analyse des co√ªts -->
                    <div class="bg-white border rounded-lg p-6">
                        <h5 class="font-semibold text-gray-800 mb-4">Analyse des Co√ªts</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h6 class="font-medium text-gray-700 mb-3">Co√ªts de revient</h6>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Prix d'achat unitaire:</span>
                                        <span class="font-semibold">${selectedItem.prixUnitaire}$</span>
                                    </div>
                                    ${selectedItem.nomenclatures?.find(n => n.active) ? `
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Co√ªt production unitaire:</span>
                                            <span class="font-semibold">${(selectedItem.nomenclatures.find(n => n.active).coutTotal || 0).toFixed(2)}$</span>
                                        </div>
                                    ` : ''}
                                    <div class="flex justify-between border-t pt-2">
                                        <span class="text-gray-600">Valeur stock total:</span>
                                        <span class="font-bold text-green-600">${selectedItem.valeur.toLocaleString()}$</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h6 class="font-medium text-gray-700 mb-3">Recommandations</h6>
                                <div class="space-y-2 text-sm">
                                    ${selectedItem.quantite <= selectedItem.seuilMin ? 
                                        '<div class="p-3 bg-red-50 border border-red-200 rounded text-red-700">‚ö†Ô∏è R√©approvisionner rapidement</div>' : 
                                        '<div class="p-3 bg-green-50 border border-green-200 rounded text-green-700">‚úÖ Stock suffisant</div>'
                                    }
                                    ${selectedItem.fournisseurs?.length > 1 ? 
                                        '<div class="p-3 bg-blue-50 border border-blue-200 rounded text-blue-700">üí° Comparer les fournisseurs pour optimiser les co√ªts</div>' : 
                                        '<div class="p-3 bg-yellow-50 border border-yellow-200 rounded text-yellow-700">üí° Ajouter d\'autres fournisseurs pour r√©duire les risques</div>'
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Historique des mouvements -->
                    <div class="bg-white border rounded-lg p-6">
                        <h5 class="font-semibold text-gray-800 mb-4">Historique des Mouvements (Simulation)</h5>
                        <div class="overflow-x-auto">
                            <table class="min-w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="text-left p-3">Date</th>
                                        <th class="text-left p-3">Type</th>
                                        <th class="text-left p-3">Quantit√©</th>
                                        <th class="text-left p-3">Stock apr√®s</th>
                                        <th class="text-left p-3">Motif</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-t">
                                        <td class="p-3">2025-08-30</td>
                                        <td class="p-3"><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">R√©ception</span></td>
                                        <td class="p-3 text-green-600">+50</td>
                                        <td class="p-3">${selectedItem.quantite}</td>
                                        <td class="p-3">Commande #CMD-2025-0830</td>
                                    </tr>
                                    <tr class="border-t">
                                        <td class="p-3">2025-08-28</td>
                                        <td class="p-3"><span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">Production</span></td>
                                        <td class="p-3 text-red-600">-25</td>
                                        <td class="p-3">${selectedItem.quantite - 50}</td>
                                        <td class="p-3">OF-2025-0828 - Chaise Bureau Premium</td>
                                    </tr>
                                    <tr class="border-t">
                                        <td class="p-3">2025-08-25</td>
                                        <td class="p-3"><span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">Ajustement</span></td>
                                        <td class="p-3 text-red-600">-5</td>
                                        <td class="p-3">${selectedItem.quantite - 25}</td>
                                        <td class="p-3">Inventaire physique - √âcart constat√©</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fonctions d'√©v√©nement
        function setActiveModule(module) {
            activeModule = module;
            renderApp();
        }

        function openModal(type) {
            modalType = type;
            showModal = true;
            renderApp();
        }

        function closeModal() {
            showModal = false;
            modalType = '';
            renderApp();
        }

        function openItemDetail(id) {
            selectedItem = inventaire.find(item => item.id === id);
            showItemDetail = true;
            currentTab = 'general'; // Reset √† l'onglet g√©n√©ral
            renderApp();
        }

        function closeItemDetail() {
            showItemDetail = false;
            selectedItem = null;
            currentTab = 'general';
            renderApp();
        }

        function submitForm() {
            const form = document.getElementById('modalForm');
            const formData = new FormData(form);
            
            if (modalType === 'inventaire') {
                const newId = Math.max(...inventaire.map(i => i.id), 0) + 1;
                const quantite = parseFloat(formData.get('quantite')) || 0;
                const prixUnitaire = parseFloat(formData.get('prixUnitaire')) || 0;
                
                const newItem = {
                    id: newId,
                    nom: formData.get('nom'),
                    categorie: formData.get('categorie'),
                    quantite: quantite,
                    unite: formData.get('unite'),
                    typeUnite: 'unit√©',
                    prixUnitaire: prixUnitaire,
                    valeur: quantite * prixUnitaire,
                    seuilMin: 5,
                    fournisseurPrincipal: formData.get('fournisseurPrincipal') || 'Non d√©fini',
                    fournisseurs: [{
                        nom: formData.get('fournisseurPrincipal') || 'Non d√©fini',
                        prix: prixUnitaire,
                        delai: '1-2 jours'
                    }],
                    recette: [],
                    description: formData.get('description') || ''
                };
                
                inventaire.push(newItem);
            }
            
            closeModal();
        }

        function deleteItem(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cet article ?')) {
                inventaire.splice(inventaire.findIndex(item => item.id === id), 1);
                renderApp();
            }
        }

        function editItem(id) {
            openItemDetail(id);
        }

        function getStatusColor(statut) {
            switch(statut) {
                case 'Termin√©': return 'bg-green-100 text-green-800';
                case 'En cours': return 'bg-blue-100 text-blue-800';
                case 'Planifi√©': return 'bg-yellow-100 text-yellow-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // D√©marrer l'application
        renderApp();
    </script>
</body>
</html>