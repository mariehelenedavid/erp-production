<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Production</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root">
        <div style="padding: 20px; text-align: center;">
            <p>Chargement de l'ERP...</p>
        </div>
    </div>
    
    <script>
        // Application ERP simplifiée et robuste
        let activeModule = 'dashboard';
        let showModal = false;
        let modalType = '';
        let selectedItem = null;
        let showItemDetail = false;

        // Données initiales
        let productions = [
            {
                id: 1,
                produit: 'Chaise Bureau Premium',
                quantite: 50,
                statut: 'En cours',
                dateDebut: '2025-08-25',
                dateFin: '2025-09-05',
                coutMatiere: 1250,
                coutMainOeuvre: 800,
                progression: 65
            },
            {
                id: 2,
                produit: 'Table Conférence XL',
                quantite: 10,
                statut: 'Planifié',
                dateDebut: '2025-09-10',
                dateFin: '2025-09-20',
                coutMatiere: 2800,
                coutMainOeuvre: 1200,
                progression: 0
            },
            {
                id: 3,
                produit: 'Armoire Classement',
                quantite: 25,
                statut: 'Terminé',
                dateDebut: '2025-08-10',
                dateFin: '2025-08-30',
                coutMatiere: 1875,
                coutMainOeuvre: 750,
                progression: 100
            }
        ];

        let inventaire = [
            {
                id: 1,
                nom: 'Bois Chêne Premium',
                categorie: 'Matière Première',
                quantite: 120,
                unite: 'm²',
                typeUnite: 'surface',
                prixUnitaire: 45,
                valeur: 5400,
                seuilMin: 20,
                fournisseurPrincipal: 'Bois du Québec Inc.',
                fournisseurs: [
                    { nom: 'Bois du Québec Inc.', prix: 45, delai: '5-7 jours' },
                    { nom: 'Foresterie Premium', prix: 48, delai: '3-5 jours' }
                ],
                recette: [],
                description: 'Bois de chêne premium pour meubles haut de gamme'
            },
            {
                id: 2,
                nom: 'Quincaillerie Haut Gamme',
                categorie: 'Composants',
                quantite: 500,
                unite: 'pcs',
                typeUnite: 'unité',
                prixUnitaire: 8.5,
                valeur: 4250,
                seuilMin: 100,
                fournisseurPrincipal: 'Métaux Spécialisés',
                fournisseurs: [
                    { nom: 'Métaux Spécialisés', prix: 8.5, delai: '2-3 jours' },
                    { nom: 'Quincaillerie Pro', prix: 9.0, delai: '1-2 jours' }
                ],
                recette: [],
                description: 'Visserie et quincaillerie de qualité professionnelle'
            },
            {
                id: 3,
                nom: 'Vernis Protection',
                categorie: 'Finition',
                quantite: 15,
                unite: 'L',
                typeUnite: 'volume',
                prixUnitaire: 35,
                valeur: 525,
                seuilMin: 5,
                fournisseurPrincipal: 'Chimie Pro',
                fournisseurs: [
                    { nom: 'Chimie Pro', prix: 35, delai: '1-2 jours' },
                    { nom: 'Finitions Expert', prix: 33, delai: '3-4 jours' }
                ],
                recette: [],
                description: 'Vernis de protection haute qualité pour finitions durables'
            },
            {
                id: 4,
                nom: 'Chaise Bureau Premium',
                categorie: 'Produit Fini',
                quantite: 75,
                unite: 'pcs',
                typeUnite: 'unité',
                prixUnitaire: 250,
                valeur: 18750,
                seuilMin: 10,
                fournisseurPrincipal: 'Production Interne',
                fournisseurs: [
                    { nom: 'Production Interne', prix: 250, delai: 'immédiat' }
                ],
                recette: [
                    { composant: 'Bois Chêne Premium', quantite: 2.5, unite: 'm²' },
                    { composant: 'Quincaillerie Haut Gamme', quantite: 15, unite: 'pcs' },
                    { composant: 'Vernis Protection', quantite: 0.5, unite: 'L' }
                ],
                description: 'Chaise de bureau ergonomique en chêne premium'
            }
        ];

        let mainOeuvre = [
            {
                id: 1,
                employe: 'Jean Tremblay',
                poste: 'Ébéniste Senior',
                tauxHoraire: 35,
                heuresTravaillees: 160,
                coutTotal: 5600,
                mois: 'Août 2025'
            },
            {
                id: 2,
                employe: 'Marie Dubois',
                poste: 'Finition Spécialiste',
                tauxHoraire: 30,
                heuresTravaillees: 155,
                coutTotal: 4650,
                mois: 'Août 2025'
            },
            {
                id: 3,
                employe: 'Pierre Lavoie',
                poste: 'Assembleur',
                tauxHoraire: 25,
                heuresTravaillees: 165,
                coutTotal: 4125,
                mois: 'Août 2025'
            }
        ];

        // Fonctions utilitaires
        function calculateKPIs() {
            const totalProductions = productions.length;
            const productionsEnCours = productions.filter(p => p.statut === 'En cours').length;
            const valeurInventaireTotal = inventaire.reduce((sum, item) => sum + item.valeur, 0);
            const coutMainOeuvreTotal = mainOeuvre.reduce((sum, mo) => sum + mo.coutTotal, 0);
            const coutMatiereTotal = productions.reduce((sum, p) => sum + p.coutMatiere, 0);
            const alertesStock = inventaire.filter(item => item.quantite <= item.seuilMin).length;

            return {
                totalProductions,
                productionsEnCours,
                valeurInventaireTotal,
                coutMainOeuvreTotal,
                coutMatiereTotal,
                alertesStock
            };
        }

        function renderApp() {
            const kpis = calculateKPIs();
            
            const app = `
                <div class="flex min-h-screen bg-gray-100">
                    <!-- Navigation -->
                    <div class="bg-blue-900 text-white w-64 min-h-screen p-4">
                        <h1 class="text-2xl font-bold mb-8 text-center">ERP Production</h1>
                        <nav class="space-y-2">
                            <button onclick="setActiveModule('dashboard')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'dashboard' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>📊</span><span>Tableau de Bord</span>
                            </button>
                            <button onclick="setActiveModule('production')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'production' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>🔧</span><span>Production</span>
                            </button>
                            <button onclick="setActiveModule('inventaire')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'inventaire' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>📦</span><span>Inventaire</span>
                            </button>
                            <button onclick="setActiveModule('couts')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'couts' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>💰</span><span>Coûts</span>
                            </button>
                            <button onclick="setActiveModule('rapports')" class="w-full flex items-center space-x-3 p-3 rounded-lg transition-colors ${activeModule === 'rapports' ? 'bg-blue-700' : 'hover:bg-blue-800'}">
                                <span>📋</span><span>Rapports</span>
                            </button>
                        </nav>
                    </div>

                    <!-- Contenu principal -->
                    <div class="flex-1 p-6">
                        ${renderActiveModule(kpis)}
                    </div>
                </div>

                ${showModal ? renderModal() : ''}
                ${showItemDetail ? renderItemDetail() : ''}
            `;

            document.getElementById('root').innerHTML = app;
        }

        function renderActiveModule(kpis) {
            switch(activeModule) {
                case 'dashboard': return renderDashboard(kpis);
                case 'production': return renderProduction();
                case 'inventaire': return renderInventaire(kpis);
                case 'couts': return renderCouts(kpis);
                case 'rapports': return renderRapports();
                default: return renderDashboard(kpis);
            }
        }

        function renderDashboard(kpis) {
            return `
                <div class="space-y-6">
                    <h2 class="text-3xl font-bold text-gray-800">Tableau de Bord</h2>
                    
                    <!-- KPIs -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm">Productions Totales</p>
                                    <p class="text-2xl font-bold text-gray-800">${kpis.totalProductions}</p>
                                </div>
                                <span class="text-blue-500 text-2xl">🔧</span>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm">En Cours</p>
                                    <p class="text-2xl font-bold text-gray-800">${kpis.productionsEnCours}</p>
                                </div>
                                <span class="text-green-500 text-2xl">⏰</span>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm">Valeur Inventaire</p>
                                    <p class="text-2xl font-bold text-gray-800">${kpis.valeurInventaireTotal.toLocaleString()}$</p>
                                </div>
                                <span class="text-purple-500 text-2xl">📦</span>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm">Alertes Stock</p>
                                    <p class="text-2xl font-bold text-gray-800">${kpis.alertesStock}</p>
                                </div>
                                <span class="text-red-500 text-2xl">⚠️</span>
                            </div>
                        </div>
                    </div>

                    <!-- Productions récentes -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Productions Récentes</h3>
                            <div class="space-y-3">
                                ${productions.slice(0, 3).map(prod => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800">${prod.produit}</p>
                                            <p class="text-sm text-gray-600">Quantité: ${prod.quantite}</p>
                                        </div>
                                        <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(prod.statut)}">
                                            ${prod.statut}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Coûts du Mois</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Matières Premières</span>
                                    <span class="font-semibold text-gray-800">${kpis.coutMatiereTotal.toLocaleString()}$</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Main d'Œuvre</span>
                                    <span class="font-semibold text-gray-800">${kpis.coutMainOeuvreTotal.toLocaleString()}$</span>
                                </div>
                                <div class="border-t pt-2 flex justify-between items-center font-bold">
                                    <span class="text-gray-800">Total</span>
                                    <span class="text-gray-800">${(kpis.coutMatiereTotal + kpis.coutMainOeuvreTotal).toLocaleString()}$</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderInventaire(kpis) {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-800">Gestion d'Inventaire</h2>
                        <button onclick="openModal('inventaire')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2">
                            <span>➕</span><span>Ajouter Article</span>
                        </button>
                    </div>

                    ${kpis.alertesStock > 0 ? `
                        <div class="bg-red-50 border-l-4 border-red-400 p-4">
                            <div class="flex">
                                <span class="text-red-400 mr-3">⚠️</span>
                                <p class="text-sm text-red-700">
                                    <strong>Alerte Stock:</strong> ${kpis.alertesStock} article(s) sous le seuil minimum
                                </p>
                            </div>
                        </div>
                    ` : ''}

                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Article</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Catégorie</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix Unit.</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valeur</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${inventaire.map(item => `
                                        <tr class="hover:bg-gray-50 cursor-pointer" onclick="openItemDetail(${item.id})">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${item.nom}</div>
                                                <div class="text-sm text-gray-500">${item.fournisseurPrincipal}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.categorie}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.quantite} ${item.unite}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.prixUnitaire}$</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.valeur.toLocaleString()}$</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${item.quantite <= item.seuilMin ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                                    ${item.quantite <= item.seuilMin ? 'Stock Bas' : 'OK'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2" onclick="event.stopPropagation()">
                                                <button onclick="openItemDetail(${item.id})" class="text-blue-600 hover:text-blue-900" title="Voir détails">👁️</button>
                                                <button onclick="editItem(${item.id})" class="text-green-600 hover:text-green-900" title="Modifier">✏️</button>
                                                <button onclick="deleteItem(${item.id})" class="text-red-600 hover:text-red-900" title="Supprimer">🗑️</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProduction() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-800">Gestion de Production</h2>
                        <button onclick="openModal('production')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2">
                            <span>➕</span><span>Nouvel Ordre</span>
                        </button>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produit</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantité</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progression</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Coût Total</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${productions.map(prod => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${prod.produit}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${prod.quantite}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(prod.statut)}">
                                                    ${prod.statut}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${prod.progression}%"></div>
                                                </div>
                                                <span class="text-xs text-gray-500">${prod.progression}%</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                ${(prod.coutMatiere + prod.coutMainOeuvre).toLocaleString()}$
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCouts(kpis) {
            return `
                <div class="space-y-6">
                    <h2 class="text-3xl font-bold text-gray-800">Gestion des Coûts</h2>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Matières Premières</h3>
                            <p class="text-2xl font-bold text-blue-600">${kpis.coutMatiereTotal.toLocaleString()}$</p>
                            <p class="text-sm text-gray-500">Ce mois</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Main d'Œuvre</h3>
                            <p class="text-2xl font-bold text-green-600">${kpis.coutMainOeuvreTotal.toLocaleString()}$</p>
                            <p class="text-sm text-gray-500">Ce mois</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Total</h3>
                            <p class="text-2xl font-bold text-purple-600">${(kpis.coutMatiereTotal + kpis.coutMainOeuvreTotal).toLocaleString()}$</p>
                            <p class="text-sm text-gray-500">Ce mois</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Détail Main d'Œuvre</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employé</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Poste</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Taux/h</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Heures</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Coût Total</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${mainOeuvre.map(mo => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${mo.employe}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mo.poste}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mo.tauxHoraire}$/h</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mo.heuresTravaillees}h</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${mo.coutTotal.toLocaleString()}$</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRapports() {
            return `
                <div class="space-y-6">
                    <h2 class="text-3xl font-bold text-gray-800">Rapports & Analyses</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Rentabilité par Produit</h3>
                            <div class="space-y-4">
                                ${productions.map(prod => {
                                    const coutTotal = prod.coutMatiere + prod.coutMainOeuvre;
                                    const coutUnitaire = coutTotal / prod.quantite;
                                    const prixVenteEstime = coutUnitaire * 1.5;
                                    const beneficeUnitaire = prixVenteEstime - coutUnitaire;
                                    
                                    return `
                                        <div class="border rounded-lg p-4">
                                            <h4 class="font-medium text-gray-800">${prod.produit}</h4>
                                            <div class="mt-2 space-y-1 text-sm">
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600">Coût unitaire:</span>
                                                    <span>${Math.round(coutUnitaire)}$</span>
                                                </div>
                                                <div class="flex justify-between">
                                                    <span class="text-gray-600">Prix de vente estimé:</span>
                                                    <span>${Math.round(prixVenteEstime)}$</span>
                                                </div>
                                                <div class="flex justify-between font-medium">
                                                    <span class="text-gray-800">Bénéfice unitaire:</span>
                                                    <span class="text-green-600">+${Math.round(beneficeUnitaire)}$</span>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Performance Mensuelle</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                    <span class="text-gray-700">Productions terminées</span>
                                    <span class="font-bold text-blue-600">${productions.filter(p => p.statut === 'Terminé').length}</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                    <span class="text-gray-700">Valeur produite</span>
                                    <span class="font-bold text-green-600">
                                        ${productions
                                            .filter(p => p.statut === 'Terminé')
                                            .reduce((sum, p) => sum + (p.coutMatiere + p.coutMainOeuvre), 0)
                                            .toLocaleString()}$
                                    </span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                                    <span class="text-gray-700">Efficacité moyenne</span>
                                    <span class="font-bold text-purple-600">92%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderModal() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold mb-6">
                                ${modalType === 'production' ? 'Nouvel Ordre de Production' : 'Nouvel Article Inventaire'}
                            </h3>
                            
                            <form id="modalForm" class="space-y-4">
                                ${modalType === 'inventaire' ? `
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <input name="nom" type="text" placeholder="Nom de l'article" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                        <select name="categorie" class="w-full p-3 border border-gray-300 rounded-lg" required>
                                            <option value="">Sélectionner catégorie</option>
                                            <option value="Matière Première">Matière Première</option>
                                            <option value="Composants">Composants</option>
                                            <option value="Finition">Finition</option>
                                            <option value="Produit Fini">Produit Fini</option>
                                        </select>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <input name="quantite" type="number" placeholder="Quantité" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                        <input name="unite" type="text" placeholder="Unité (kg, pcs, L...)" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                        <input name="prixUnitaire" type="number" step="0.01" placeholder="Prix unitaire" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                    </div>
                                    
                                    <input name="fournisseurPrincipal" type="text" placeholder="Fournisseur principal" class="w-full p-3 border border-gray-300 rounded-lg" />
                                    <textarea name="description" placeholder="Description" class="w-full p-3 border border-gray-300 rounded-lg h-20"></textarea>
                                ` : `
                                    <input name="produit" type="text" placeholder="Nom du produit" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                    <input name="quantite" type="number" placeholder="Quantité" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                    <input name="dateDebut" type="date" class="w-full p-3 border border-gray-300 rounded-lg" required />
                                    <input name="coutMatiere" type="number" placeholder="Coût matière" class="w-full p-3 border border-gray-300 rounded-lg" />
                                `}
                            </form>
                            
                            <div class="flex space-x-3 mt-6">
                                <button onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    Annuler
                                </button>
                                <button onclick="submitForm()" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    Créer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderItemDetail() {
            if (!selectedItem) return '';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-semibold text-gray-800">Détails - ${selectedItem.nom}</h3>
                                <button onclick="closeItemDetail()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                    Fermer
                                </button>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <!-- Informations générales -->
                                <div class="space-y-6">
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Informations Générales</h4>
                                        <div class="space-y-3">
                                            <p><strong>Nom:</strong> ${selectedItem.nom}</p>
                                            <p><strong>Catégorie:</strong> ${selectedItem.categorie}</p>
                                            <p><strong>Stock:</strong> ${selectedItem.quantite} ${selectedItem.unite}</p>
                                            <p><strong>Prix unitaire:</strong> ${selectedItem.prixUnitaire}$</p>
                                            <p><strong>Valeur totale:</strong> ${selectedItem.valeur.toLocaleString()}$</p>
                                            <p><strong>Description:</strong> ${selectedItem.description || 'Aucune description'}</p>
                                        </div>
                                    </div>

                                    <!-- Fournisseurs -->
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Fournisseurs</h4>
                                        <div class="space-y-2">
                                            ${selectedItem.fournisseurs?.map(f => `
                                                <div class="border rounded-lg p-3 bg-gray-50">
                                                    <p class="font-medium">${f.nom}</p>
                                                    <p class="text-sm text-gray-600">${f.prix}$ - Délai: ${f.delai}</p>
                                                </div>
                                            `).join('') || '<p class="text-gray-500">Aucun fournisseur défini</p>'}
                                        </div>
                                    </div>
                                </div>

                                <!-- Recette -->
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Recette/Nomenclature</h4>
                                    ${selectedItem.recette?.length > 0 ? `
                                        <div class="space-y-2">
                                            ${selectedItem.recette.map(c => `
                                                <div class="border rounded-lg p-3 bg-blue-50">
                                                    <p class="font-medium">${c.composant}</p>
                                                    <p class="text-sm text-gray-600">${c.quantite} ${c.unite}</p>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : '<p class="text-gray-500">Aucun composant défini</p>'}
                                    
                                    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                        <h5 class="font-semibold text-gray-800 mb-2">Statut</h5>
                                        <span class="px-3 py-1 rounded-full text-sm font-medium ${selectedItem.quantite <= selectedItem.seuilMin ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                            ${selectedItem.quantite <= selectedItem.seuilMin ? 'Stock Bas - Réapprovisionner' : 'Stock Suffisant'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fonctions d'événement
        function setActiveModule(module) {
            activeModule = module;
            renderApp();
        }

        function openModal(type) {
            modalType = type;
            showModal = true;
            renderApp();
        }

        function closeModal() {
            showModal = false;
            modalType = '';
            renderApp();
        }

        function openItemDetail(id) {
            selectedItem = inventaire.find(item => item.id === id);
            showItemDetail = true;
            renderApp();
        }

        function closeItemDetail() {
            showItemDetail = false;
            selectedItem = null;
            renderApp();
        }

        function submitForm() {
            const form = document.getElementById('modalForm');
            const formData = new FormData(form);
            
            if (modalType === 'inventaire') {
                const newId = Math.max(...inventaire.map(i => i.id), 0) + 1;
                const quantite = parseFloat(formData.get('quantite')) || 0;
                const prixUnitaire = parseFloat(formData.get('prixUnitaire')) || 0;
                
                const newItem = {
                    id: newId,
                    nom: formData.get('nom'),
                    categorie: formData.get('categorie'),
                    quantite: quantite,
                    unite: formData.get('unite'),
                    typeUnite: 'unité',
                    prixUnitaire: prixUnitaire,
                    valeur: quantite * prixUnitaire,
                    seuilMin: 5,
                    fournisseurPrincipal: formData.get('fournisseurPrincipal') || 'Non défini',
                    fournisseurs: [{
                        nom: formData.get('fournisseurPrincipal') || 'Non défini',
                        prix: prixUnitaire,
                        delai: '1-2 jours'
                    }],
                    recette: [],
                    description: formData.get('description') || ''
                };
                
                inventaire.push(newItem);
            }
            
            closeModal();
        }

        function deleteItem(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cet article ?')) {
                inventaire.splice(inventaire.findIndex(item => item.id === id), 1);
                renderApp();
            }
        }

        function editItem(id) {
            openItemDetail(id);
        }

        function getStatusColor(statut) {
            switch(statut) {
                case 'Terminé': return 'bg-green-100 text-green-800';
                case 'En cours': return 'bg-blue-100 text-blue-800';
                case 'Planifié': return 'bg-yellow-100 text-yellow-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Démarrer l'application
        renderApp();
    </script>
</body>
</html>